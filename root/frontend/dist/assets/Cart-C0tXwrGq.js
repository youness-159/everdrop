import{r as a,_ as l,j as e,w as x,C as p,u as m}from"./index-D20nmIH3.js";import{B as d}from"./Button-H5VG5V_F.js";import{f as h,s as j}from"./shopAPI-BOLETFd3.js";import{u as f}from"./index.esm-DmimYm8l.js";import{u}from"./useMutation-DyA3nlKG.js";import{e as y}from"./couponAPI-ChP47HpJ.js";import{UserContext as b}from"./userContextAPI-CEPSfSC_.js";import{b as g}from"./userAPI-CITHf_Ex.js";import{u as C}from"./useQuery-BIalZ7-4.js";import{g as N,d as S}from"./cartAPI-CYNTN5LZ.js";import{L as v}from"./Loader-D6LGd44p.js";import"./helpers-CVGqI_J_.js";import"./utils-km2FGkQ4.js";const E=async()=>await h("/orders/checkout-session"),T="pk_test_51Pncz5HAVxOlP3PKb1roLKspUq0rQJOIUXZzMHTaGNGerCDwO2rMmftwBZFQyNpbZFM8rr736Hn5HXQhP4J7fflY00g5oEssjE";function w(){const{setUser:s}=a.useContext(b),{mutate:t,isSuccess:r}=u({mutationFn:y,onSuccess:()=>{l.success("coupon applied"),(async()=>{const n=await g();s(n)})()},onError:n=>l.error(n.message)});return{mutate:t,isSuccess:r}}function z(){const{data:s,isLoading:t}=C({queryKey:["myCart"],queryFn:N});return{cartItems:s,isLoading:t}}function k(){const{mutate:s,isSuccess:t}=u({mutationFn:S,onError:r=>console.log(r.message)});return{mutate:s,isSuccess:t}}function G(){const{cartItems:s,isLoading:t}=z();return t?e.jsx(v,{}):!s||s.length===0?e.jsx(F,{}):e.jsx(L,{cartItems:s})}function F(){const s=x();function t(){s("/")}return e.jsxs("div",{className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 text-center",children:[e.jsx("h2",{className:"text-5xl mb-12 text-zinc-700",children:"Shopping Cart"}),e.jsx("p",{className:"mb-9 text-3xl font-light ",children:"Your cart is empty !"}),e.jsxs("button",{className:"uppercase py-6 px-8 text-2xl bg-zinc-700 text-zinc-50 flex items-center gap-4 hover:bg-zinc-800 duration-[.3s]",onClick:t,children:[e.jsx("span",{children:"Continue Shopping"})," ",e.jsx("span",{className:"text-4xl ",children:e.jsx(p,{})})]})]})}function L({cartItems:s}){const[t,r]=a.useState(0);a.useEffect(()=>{r((s==null?void 0:s.reduce((o,c)=>o+c.product.price*c.quantity,0))??0)},[s]);async function n(i){i.preventDefault();const o=Stripe(T);document.getElementById("checkout-button").innerHTML="isLoading";const c=await E();if(!c)return l.error("failed to create session");await o.redirectToCheckout({sessionId:c.id})}return e.jsxs("div",{className:"px-80 py-44 flex flex-wrap items-start gap-9 min-h-screen",children:[e.jsxs("table",{className:"w-3/4",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-start font-light w-[33vw] pb-4",children:"PRODUCT"}),e.jsx("th",{className:"text-start font-light pb-4 pr-24",children:"PRICE"}),e.jsx("th",{className:"text-start font-light pb-4 pr-24",children:"QUANTITY"}),e.jsx("th",{className:"text-start font-light pb-4 pr-24",children:"TOTAL"})]})}),e.jsx("tbody",{children:e.jsx(P,{cartItems:s})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-4xl mb-6 text-gray-700",children:"Order summary"}),e.jsx("table",{children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"pr-44 py-3",children:"Sub total"}),e.jsxs("td",{children:["$",t.toFixed(2)]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"py-3",children:e.jsx("strong",{children:"Total"})}),e.jsxs("td",{children:["$",t.toFixed(2)]})]}),e.jsx("tr",{className:"text-xl",children:e.jsx("td",{children:"(Inclusive of tax $0.00)"})})]})}),e.jsx(d,{className:"uppercase py-4 mt-9 px-8 bg-zinc-700 text-zinc-100",onClick:n,id:"checkout-button",children:"Checkout"})]}),e.jsx(O,{})]})}function P({cartItems:s}){return s==null?void 0:s.map((t,r)=>e.jsx(M,{cartItem:t},r))}function M({cartItem:s}){const{mutate:t,isSuccess:r}=k(),n=m();a.useEffect(()=>{r&&n.invalidateQueries("myCart")},[n,r]);function i(o){t(o)}return e.jsxs("tr",{className:"border-b",children:[e.jsxs("td",{className:"flex my-4",children:[e.jsx("div",{className:"w-36 h-36 mr-4 border border-zinc-300",children:e.jsx("img",{src:`${j}/imgs/products/${s.product.coverImage}`,alt:""})}),e.jsxs("div",{children:[e.jsx("h2",{className:"font-medium text-gray-600",children:s.product.name}),e.jsxs("div",{className:"text-gray-700 my-2",children:[e.jsxs("p",{children:["Size: ",s.productSize]}),e.jsxs("p",{children:["Color: ",s.productColor]})]}),e.jsx(d,{className:"text-gray-500 border-b-2",onClick:()=>i(s._id),children:"Remove"})]})]}),e.jsxs("td",{children:["$",s.product.price.toFixed(2)]}),e.jsx("td",{children:s.quantity}),e.jsxs("td",{children:["$",(s.product.price*s.quantity).toFixed(2)]})]})}function O(){const{register:s,handleSubmit:t}=f(),{mutate:r,isSuccess:n}=w();function i(o){r(o)}return e.jsxs("form",{onSubmit:t(i),children:[e.jsx("p",{className:"font-medium",children:"Promotion code?"}),e.jsxs("div",{className:"space-x-6",children:[e.jsx("input",{type:"text",placeholder:"Enter coupon code",className:"py-4 px-4 border border-gray-400 rounded-md",...s("code")}),e.jsx(d,{className:"px-8 py-4 bg-zinc-700 text-zinc-100",children:"Apply"})]})]})}export{G as default};
